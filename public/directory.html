<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>镜像站点</title>
  <style>{style}
  </style>
  <script src="https://cdn.bootcss.com/jquery/3.3.0/jquery.min.js"></script>
  <script>
    var ENCRYPTEdDIR = "/node_modules";
    var url = window.location.pathname;
    url = url.slice(0, ENCRYPTEdDIR.length);
    if (url === ENCRYPTEdDIR) {
      var password = "";
      password = prompt('请输入密码 (本网站需输入密码才可进入):', '');
      $.ajax({
        url: '/login?password=' + password,
        success: function (data) {
          if (data !== 'ok') {
            alert("密码不正确,无法进入本站!!");
            window.location.href = window.location.origin;
          }
        },
        fail: function () {
          window.location.href = window.location.origin;
        }
      });
    }
    function ka(id) {
      var el = 'string' == typeof id
        ? document.getElementById(id)
        : id;

      el.on = function (event, fn) {
        if ('content loaded' == event) {
          event = window.attachEvent ? "load" : "DOMContentLoaded";
        }
        el.addEventListener
          ? el.addEventListener(event, fn, false)
          : el.attachEvent("on" + event, fn);
      };

      el.all = function (selector) {
        return ka(el.querySelectorAll(selector));
      };

      el.each = function (fn) {
        for (var i = 0, len = el.length; i < len; ++i) {
          fn(ka(el[i]), i);
        }
      };

      el.getClasses = function () {
        return this.getAttribute('class').split(/\s+/);
      };

      el.addClass = function (name) {
        var classes = this.getAttribute('class');
        el.setAttribute('class', classes
          ? classes + ' ' + name
          : name);
      };

      el.removeClass = function (name) {
        var classes = this.getClasses().filter(function (curr) {
          return curr != name;
        });
        this.setAttribute('class', classes.join(' '));
      };

      return el;
    }

    function search() {
      var str = ka('search').value.toLowerCase();
      var links = ka('files').all('a');

      links.each(function (link) {
        var text = link.textContent.toLowerCase();

        if ('..' == text) return;
        if (str.length && ~text.indexOf(str)) {
          link.addClass('highlight');
        } else {
          link.removeClass('highlight');
        }
      });
    }

    ka(window).on('content loaded', function () {
      ka('search').on('keyup', search);
    });
  </script>
</head>

<body class="directory">
  <input id="search" type="text" placeholder="Search" autocomplete="off" />
  <div id="wrapper">
    <h1><a href="/">~</a>{linked-path}</h1>
    {files}
  </div>
</body>

</html>